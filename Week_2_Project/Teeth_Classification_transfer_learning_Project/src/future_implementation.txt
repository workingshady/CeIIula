modular version of model and train and inference